window.__require=function t(e,i,o){function s(c,a){if(!i[c]){if(!e[c]){var r=c.split("/");if(r=r[r.length-1],!e[r]){var h="function"==typeof __require&&__require;if(!a&&h)return h(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var d=i[c]={exports:{}};e[c][0].call(d.exports,function(t){return s(e[c][1][t]||t)},d,d.exports,t,e,i,o)}return i[c].exports}for(var n="function"==typeof __require&&__require,c=0;c<o.length;c++)s(o[c]);return s}({JoystickEnum:[function(t,e,i){"use strict";cc._RF.push(e,"31870IQfNZJtpT/cTZzx1QP","JoystickEnum"),i.__esModule=!0,i.default=void 0;var o={JoystickType:cc.Enum({FIXED:0,FOLLOW:1}),DirectionType:cc.Enum({FOUR:4,EIGHT:8,ALL:0}),SpeedType:cc.Enum({STOP:0,NORMAL:1,FAST:2}),JoystickEventType:cc.Enum({TOUCH_START:"touchStart",TOUCH_MOVE:"touchMove",TOUCH_END:"touchEnd",CHANGE_JOYSTICK_TYPE:"changeJoystickType"})};i.default=o,e.exports=i.default,cc._RF.pop()},{}],JoystickEvent:[function(t,e,i){"use strict";cc._RF.push(e,"63405xHk7lPM5DUlhTZsSeE","JoystickEvent"),i.__esModule=!0,i.default=void 0;var o=cc.Class({properties:{_event:null},ctor:function(){this._event=new cc.EventTarget},on:function(t,e,i){this._event.on(t,e,i)},off:function(t,e,i){this._event.off(t,e,i)},emit:function(t){for(var e,i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];(e=this._event).emit.apply(e,[t].concat(o))}}),s=null;o.getInstance=function(){return!s&&(s=new o),s};var n=o;i.default=n,e.exports=i.default,cc._RF.pop()},{}],Joystick:[function(t,e,i){"use strict";cc._RF.push(e,"0423aB7i/pDPKZcd537thtu","Joystick");var o=n(t("JoystickEnum")),s=n(t("JoystickEvent"));function n(t){return t&&t.__esModule?t:{default:t}}cc.Class({extends:cc.Component,properties:{dot:{default:null,type:cc.Node,displayName:"Dot",tooltip:"\u6447\u6746\u64cd\u7eb5\u70b9"},ring:{default:null,type:cc.Node,displayName:"Ring",tooltip:"\u6447\u6746\u80cc\u666f\u8282\u70b9"},joystickType:{default:o.default.JoystickType.FIXED,type:o.default.JoystickType,displayName:"Touch Type",tooltip:"\u89e6\u6478\u7c7b\u578b"},directionType:{default:o.default.DirectionType.ALL,type:o.default.DirectionType,displayName:"Direction Type",tooltip:"\u65b9\u5411\u7c7b\u578b"},_stickPos:{default:null,type:cc.Node,tooltip:"\u6447\u6746\u6240\u5728\u4f4d\u7f6e"},_touchLocation:{default:null,type:cc.Node,tooltip:"\u89e6\u6478\u4f4d\u7f6e"}},onLoad:function(){this._radius=this.ring.width/2,this._initTouchEvent(),this.joystickType===o.default.JoystickType.FOLLOW&&(this.node.opacity=0)},onEnable:function(){s.default.getInstance().on(o.default.JoystickEventType.CHANGE_JOYSTICK_TYPE,this._onChangeJoystickType,this)},onDisable:function(){s.default.getInstance().off(o.default.JoystickEventType.CHANGE_JOYSTICK_TYPE,this._onChangeJoystickType,this)},_onChangeJoystickType:function(t){this.joystickType=t,this.node.opacity=t===o.default.JoystickType.FIXED?255:0},_initTouchEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStartEvent,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchMoveEvent,this),this.node.on(cc.Node.EventType.TOUCH_END,this._touchEndEvent,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEndEvent,this)},_touchStartEvent:function(t){s.default.getInstance().emit(o.default.JoystickEventType.TOUCH_START,"joystick touch start",10);var e=this.node.convertToNodeSpaceAR(t.getLocation());if(this.joystickType===o.default.JoystickType.FIXED){this._stickPos=this.ring.getPosition();var i=e.sub(this.ring.getPosition()).mag();this._radius>i&&this.dot.setPosition(e)}else this.joystickType===o.default.JoystickType.FOLLOW&&(this._stickPos=e,this.node.opacity=255,this._touchLocation=t.getLocation(),this.ring.setPosition(e),this.dot.setPosition(e))},_touchMoveEvent:function(t){if(this.joystickType===o.default.JoystickType.FOLLOW&&this._touchLocation===t.getLocation())return!1;var e,i=this.ring.convertToNodeSpaceAR(t.getLocation()),n=i.mag(),c=this._stickPos.x+i.x,a=this._stickPos.y+i.y,r=cc.v2(c,a).sub(this.ring.getPosition()).normalize();if(this._radius>n)this.dot.setPosition(cc.v2(c,a)),e=o.default.SpeedType.NORMAL;else{var h=this._stickPos.x+r.x*this._radius,d=this._stickPos.y+r.y*this._radius;this.dot.setPosition(cc.v2(h,d)),e=o.default.SpeedType.FAST}s.default.getInstance().emit(o.default.JoystickEventType.TOUCH_MOVE,t,{speedType:e,moveDistance:r})},_touchEndEvent:function(t){this.dot.setPosition(this.ring.getPosition()),this.joystickType===o.default.JoystickType.FOLLOW&&(this.node.opacity=0),s.default.getInstance().emit(o.default.JoystickEventType.TOUCH_END,t,{speedType:o.default.SpeedType.STOP})}}),cc._RF.pop()},{JoystickEnum:"JoystickEnum",JoystickEvent:"JoystickEvent"}],build:[function(t,e,i){"use strict";cc._RF.push(e,"0d94fvvIxZFNogXnBYdjx/r","build");var o=n(t("./joystick/JoystickEnum")),s=n(t("./joystick/JoystickEvent"));function n(t){return t&&t.__esModule?t:{default:t}}cc.Class({extends:cc.Component,properties:{rect0:cc.Prefab,rect1:cc.Prefab,rect2:cc.Prefab,rect3:cc.Prefab,rect4:cc.Prefab,rect5:cc.Prefab,rect6:cc.Prefab,rect7:cc.Prefab,moveDir:{default:cc.v2(0,1),displayName:"Move Dir",tooltip:"\u79fb\u52a8\u65b9\u5411"},_speedType:{default:o.default.SpeedType.STOP,displayName:"Speed Type",type:o.default.SpeedType,tooltip:"\u901f\u5ea6\u7ea7\u522b"},player:cc.Prefab,basepoint:cc.Prefab,button:cc.Label,score:cc.Label,over:cc.Node,sliderv:cc.Slider,audio:cc.AudioClip,subNodesArr:{default:[],type:cc.Prefab}},onLoad:function(){cc.log("onload start"),s.default.getInstance().on(o.default.JoystickEventType.TOUCH_START,this.onTouchStart,this),s.default.getInstance().on(o.default.JoystickEventType.TOUCH_MOVE,this.onTouchMove,this),s.default.getInstance().on(o.default.JoystickEventType.TOUCH_END,this.onTouchEnd,this),cc.director.getCollisionManager().enabled=!0,cc.director.getPhysicsManager().enabled=!0;cc.PhysicsManager.DrawBits;this.nodes=[],this.nodes=cc.find("Canvas/box/nodes").children,this.gameState=1,cc.director.getCollisionManager().enabled=!0,cc.director.getPhysicsManager().enabled=!0,this.scoreNum=0,this.leftX,this.rightX,this.speed=.5,this.direction=0,this.snakeArrX=[],this.snakeArrY=[],this.snakeArr=[],this.nextGoal=Math.floor(7*Math.random()),this.goalX=Math.floor(10*Math.random()),this.goalY=Math.floor(15*Math.random()),this.snakeHead=cc.instantiate(this.rect7).getComponent("rect"),this.snakeHead.node.x=240,this.snakeHead.node.y=336,this.snakeHead.node.Group="hero",cc.find("Canvas/box").addChild(this.snakeHead.node),this.snakeArrX[0]=this.snakeHead.node.x,this.snakeArrY[0]=this.snakeHead.node.y,this.snakeArr[0]=this.snakeHead,this.boxMap=[];for(var t=0;t<10;t++){this.boxMap[t]=[];for(var e=0;e<15;e++)this.boxMap[t][e]=0}cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),this.setGame(),this.node.on(cc.Node.EventType.TOUCH_START,function(t){var e=t.getLocation();this.firstX=e.x,this.firstY=e.y},this),this.node.on(cc.Node.EventType.TOUCH_END,function(t){var e=t.getLocation(),i=this.firstX-e.x,o=this.firstY-e.y;Math.abs(i)>Math.abs(o)?i>0?(cc.log("left"),3!=this.direction&&(this.direction=2)):(cc.log("right"),2!=this.direction&&(this.direction=3)):o>0?(cc.log("down"),0!=this.direction&&(this.direction=1)):(cc.log("up"),1!=this.direction&&(this.direction=0))},this)},onTouchStart:function(){},onTouchMove:function(t,e){this._speedType=e.speedType,this.moveDir=e.moveDistance,cc.log("this.moveDir ="+this.moveDir)},onTouchEnd:function(t,e){this._speedType=e.speedType},setGame:function(){cc.log("setGame start");var t=this.nextGoal;this.buildBody(t),cc.log("setGame end")},onBeginContact:function(t,e,i){console.log("onBeginContact")},buildBody:function(t){cc.log("goal:"+t),this.produceFoot(),this.schedule(this.move,this.speed),cc.log("goal2:"+t)},overlapFoot:function(){this.goalX=Math.floor(10*Math.random()),this.goalY=Math.floor(15*Math.random());for(var t=0;t<this.snakeArrX.length;t++)if(1===this.boxMap[this.goalX][this.goalY]){this.overlapFoot();break}this.produceFoot()},produceFoot:function(){this.nextGoal=Math.floor(7*Math.random()),this.nextGoal=4,0===this.nextGoal&&(this.prefab=this.rect0),1===this.nextGoal&&(this.prefab=this.rect1),2===this.nextGoal&&(this.prefab=this.rect2),3===this.nextGoal&&(this.prefab=this.rect3),4===this.nextGoal&&(this.prefab=this.rect4),5===this.nextGoal&&(this.prefab=this.rect5),6===this.nextGoal&&(this.prefab=this.rect6),this.snakeBody=cc.instantiate(this.prefab).getComponent("rect"),this.snakeBody.node.Group="target",cc.find("Canvas/box").addChild(this.snakeBody.node),this.snakeBody.node.x=48*this.goalX,this.snakeBody.node.y=48*this.goalY;var t=this.snakeBody.node.x/48,e=this.snakeBody.node.y/48;this.boxMap[t][e]=1},eatFoot:function(){var t=this.snakeHead.node.x/48,e=this.snakeHead.node.y/48;if(1===this.boxMap[t][e]){var i=this.snakeArrX.length;this.snakeArrX[i]=this.snakeBody.node.x,this.snakeArrY[i]=this.snakeBody.node.y,this.snakeArr[i]=this.snakeBody,this.boxMap[t][e]=0,this.addScore(),this.overlapFoot()}},addScore:function(){0===this.nextGoal&&(this.scoreNum+=50),1===this.nextGoal&&(this.scoreNum+=100),2===this.nextGoal&&(this.scoreNum+=200),3===this.nextGoal&&(this.scoreNum+=300),4===this.nextGoal&&(this.scoreNum+=400),5===this.nextGoal&&(this.scoreNum+=500),6===this.nextGoal&&(this.scoreNum+=600),this.score.string=this.scoreNum},move:function(){0===this.direction?(this.isGameOver(this.snakeHead.node.x,this.snakeHead.node.y+48),1===this.gameState&&(this.snakeHead.node.y+=48)):1===this.direction?(this.isGameOver(this.snakeHead.node.x,this.snakeHead.node.y-48),1===this.gameState&&(this.snakeHead.node.y-=48)):2===this.direction?(this.isGameOver(this.snakeHead.node.x-48,this.snakeHead.node.y),1===this.gameState&&(this.snakeHead.node.x-=48)):3===this.direction&&(this.isGameOver(this.snakeHead.node.x+48,this.snakeHead.node.y),1===this.gameState&&(this.snakeHead.node.x+=48)),1===this.gameState&&(this.eatFoot(),this.moveAll())},moveAll:function(){for(var t=this.snakeArrX.length-1;t>0;t--)this.snakeArrX[t]=this.snakeArrX[t-1],this.snakeArrY[t]=this.snakeArrY[t-1];this.snakeArrX[0]=this.snakeHead.node.x,this.snakeArrY[0]=this.snakeHead.node.y;for(var e=1;e<this.snakeArrX.length;e++)this.snakeArr[e].node.x=this.snakeArrX[e],this.snakeArr[e].node.y=this.snakeArrY[e]},onCollisionEnter:function(t,e){console.log("\u78b0\u649e  ="+t)},onKeyDown:function(t){switch(t.keyCode){case cc.macro.KEY.a:case cc.macro.KEY.left:3!=this.direction&&(this.direction=2);break;case cc.macro.KEY.d:case cc.macro.KEY.right:2!=this.direction&&(this.direction=3);break;case cc.macro.KEY.w:case cc.macro.KEY.up:1!=this.direction&&(this.direction=0);break;case cc.macro.KEY.s:case cc.macro.KEY.down:0!=this.direction&&(this.direction=1)}},isGameOver:function(t,e){if(t<0||t>=480||e<0||e>=720)this.gameOver();else{for(var i=0;i<this.nodes.length;i++)if(cc.log("nodes ="+this.nodes[i]),"target"!=this.nodes[i].Group&&this.nodes[i].x==t&&this.nodes[i].y==e)return void this.gameOver();for(var o=0;o<this.snakeArrX.length;o++)if(this.snakeArrX[o]==t&&this.snakeArrY[o]==e)return void this.gameOver()}},gameOver:function(){cc.log("\u7ed3\u675f"),this.gameState=2,this.over.active=!0,this.unschedule(this.move),cc.audioEngine.stopAll()},pause:function(){2!==this.gameState&&(1===this.gameState?(this.gameState=0,this.button.string="Play",this.unschedule(this.move)):0===this.gameState&&(this.gameState=1,this.button.string="Pause",this.schedule(this.move,this.speed)))},replay:function(){cc.director.loadScene("snaker")}}),cc._RF.pop()},{"./joystick/JoystickEnum":"JoystickEnum","./joystick/JoystickEvent":"JoystickEvent"}],rect:[function(t,e,i){"use strict";cc._RF.push(e,"20127cQSZ9N0bB8afm8IEjY","rect"),cc.Class({extends:cc.Component,properties:{},start:function(){var t=cc.director.getCollisionManager();t.enabled=!0,t.enabledDebugDraw=!0,this._game=cc.find("/Canvas/box").getComponent("build")},onBeginContact:function(t,e,i){cc.log("onBeginContact")},onCollisionEnter:function(t,e){},update:function(t){}}),cc._RF.pop()},{}],"use_v2.0.x_cc.Toggle_event":[function(t,e,i){"use strict";cc._RF.push(e,"d149fmkRdtINpsf4RJ6lEpZ","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["use_v2.0.x_cc.Toggle_event","build","Joystick","JoystickEnum","JoystickEvent","rect"]);